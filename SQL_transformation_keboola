CREATE TEMPORARY TABLE GADATUM AS
SELECT *
, REPLACE ("ga"."FILENAME",'2.1 Airport Operations per Capability - GA ') AS NAZEV_GA1
, REPLACE (NAZEV_GA1, '.csv') AS NAZEV_GA2
, TO_DATE (NAZEV_GA2, 'MONYYYY') AS DATUM 
FROM "ga";

CREATE TEMPORARY TABLE MILDATUM AS
SELECT *
, REPLACE ("military"."FILENAME",'2.1 Airport Operations per Capability - Military ') AS NAZEV_MIL1
, REPLACE (NAZEV_MIL1, '.csv') AS NAZEV_MIL2
, REPLACE (NAZEV_MIL2, 'ARP', 'APR') AS NAZEV_MIL3
, TRIM (NAZEV_MIL2) AS NAZEV_MIL4
, TO_DATE (NAZEV_MIL4, 'MONYYYY') AS DATUM 
FROM "military";

CREATE TEMPORARY TABLE NSDATUM AS
SELECT *
, REPLACE ("non-scheduled"."FILENAME",'2.1 Airport Operations per Capability - NON Scheduled') AS NAZEV_NS1
, REPLACE (NAZEV_NS1, '2.1 Airport Operations per Capability - NON Schedule') AS NAZEV_NS2
, REPLACE (NAZEV_NS2, '.csv') AS NAZEV_NS3
, REPLACE ("NAZEV_NS3", '(1)') AS NAZEV_NS4
, TRIM (NAZEV_NS4) AS NAZEV_NS5
, TO_DATE (NAZEV_NS5, 'MONYYYY') AS DATUM 
FROM "non-scheduled";

CREATE TEMPORARY TABLE SCHDATUM AS
SELECT *
, REPLACE ("scheduled"."FILENAME",'2.1 Airport Operations per Capability - Schedulede ') AS NAZEV_SCH1
, REPLACE (NAZEV_SCH1,'2.1 Airport Operations per Capability - Schedulede ') AS NAZEV_SCH2
, REPLACE (NAZEV_SCH2, '.csv') AS NAZEV_SCH3
, TRIM (NAZEV_SCH3) AS NAZEV_SCH4
, TO_DATE (NAZEV_SCH4, 'MONYYYY') AS DATUM 
FROM "scheduled";

CREATE TEMPORARY TABLE TOTALDATUM AS
SELECT *
, REPLACE ("total"."FILENAME",'2.1 Airport Operations per Capability - Absolute ') AS NAZEV_T1
//, REPLACE ("scheduled"."FILENAME",'2.1 Airport Operations per Capability - Schedulede ') AS NAZEV_SCH2
, REPLACE (NAZEV_T1, '.csv') AS NAZEV_T2
// TRIM ("FILENAME") AS NAZEV_SCH1
, TO_DATE (NAZEV_T2, 'MONYYYY') AS DATUM 
FROM "total";

// nová tabulka joinovaná na celekm
CREATE TABLE ARRIVALS AS 
SELECT T.*, "airports"."ISO_COUNTRY", "countries"."NAME", MILDATUM."MILITARY_FLIGHTS" ,SCHDATUM."SCHEDULED_FLIGHTS"
,GADATUM."GENERAL_AVIATION", NSDATUM."NON_SCHEDULED_FLIGHTS"
FROM TOTALDATUM AS T 
LEFT JOIN "airports"
ON T."AIRPORT_CODE"= "airports"."IDENT"
LEFT JOIN "countries"
ON "airports"."ISO_COUNTRY"="countries"."CODE"
LEFT JOIN MILDATUM
ON T.DATUM = MILDATUM.DATUM AND T."AIRPORT_CODE" = MILDATUM."AIRPORT_CODE"
LEFT JOIN SCHDATUM
ON T.DATUM = SCHDATUM.DATUM AND T."AIRPORT_CODE" = SCHDATUM."AIRPORT_CODE"
LEFT JOIN GADATUM
ON T.DATUM = GADATUM.DATUM AND T."AIRPORT_CODE" = GADATUM."AIRPORT_CODE"
LEFT JOIN NSDATUM
ON T.DATUM = NSDATUM.DATUM AND T."AIRPORT_CODE" = NSDATUM."AIRPORT_CODE";

CREATE TEMPORARY TABLE GADATUM AS
SELECT *
, REPLACE ("gadep"."FILENAME",'2.1 Airport Operations per Capability - General Aviation ') AS NAZEV_GA1
, REPLACE (NAZEV_GA1, '.csv') AS NAZEV_GA2
, TO_DATE (NAZEV_GA2, 'MONYYYY') AS DATUM 
FROM "gadep";

CREATE TEMPORARY TABLE MILDATUM AS
SELECT *
, REPLACE ("mildep"."FILENAME",'2.1 Airport Operations per Capability - Military ') AS NAZEV_MIL1
, REPLACE (NAZEV_MIL1, '.csv') AS NAZEV_MIL2
, REPLACE (NAZEV_MIL2, 'ARP', 'APR') AS NAZEV_MIL3
, TO_DATE (NAZEV_MIL3, 'MONYYYY') AS DATUM 
FROM "mildep";

CREATE TEMPORARY TABLE NSDATUM AS
SELECT *
, TO_DATE ("FILENAME", 'MONYYYY') AS DATUM 
FROM "nsdep";

CREATE TEMPORARY TABLE SCHDATUM AS
SELECT *
, TRIM ("FILENAME") AS NAZEV_SCH1
, TO_DATE (NAZEV_SCH1, 'MONYYYY') AS DATUM 
FROM "schdep";

CREATE TEMPORARY TABLE TOTALDATUM AS
SELECT *
, REPLACE ("total"."FILENAME",'2.1 Airport Operations per Capability - Absolute ') AS NAZEV_T1
, TO_DATE (NAZEV_T1, 'MONYYYY') AS DATUM 
FROM "total";

CREATE TABLE DEPARTURES AS 
SELECT T.*, "airports"."ISO_COUNTRY", "countries"."NAME", MILDATUM."MILITARY_FLIGHTS" ,SCHDATUM."SCHEDULED_FLIGHTS"
,GADATUM."GENERAL_AVIATION", NSDATUM."NONSCHEDULED_FLIGHTS"
FROM TOTALDATUM AS T 
LEFT JOIN "airports"
ON T."AIRPORT_CODE"= "airports"."IDENT"
LEFT JOIN "countries"
ON "airports"."ISO_COUNTRY"="countries"."CODE"
LEFT JOIN MILDATUM
ON T.DATUM = MILDATUM.DATUM AND T."AIRPORT_CODE" = MILDATUM."AIRPORT_CODE"
LEFT JOIN SCHDATUM
ON T.DATUM = SCHDATUM.DATUM AND T."AIRPORT_CODE" = SCHDATUM."AIRPORT_CODE"
LEFT JOIN GADATUM
ON T.DATUM = GADATUM.DATUM AND T."AIRPORT_CODE" = GADATUM."AIRPORT_CODE"
LEFT JOIN NSDATUM
ON T.DATUM = NSDATUM.DATUM AND T."AIRPORT_CODE" = NSDATUM."AIRPORT_CODE";

CREATE TABLE MAIN_TABLE AS
SELECT * FROM "arrivals"
UNION ALL
SELECT * FROM "departures";

CREATE TABLE MAIN_TABLE_CONTINENTS AS
SELECT MAIN_TABLE.*,  "continents"."Continent_Name"
FROM MAIN_TABLE
LEFT JOIN "continents"
ON MAIN_TABLE.ISO_COUNTRY = "continents"."Two_Letter_Country_Code";
